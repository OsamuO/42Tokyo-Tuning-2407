[mysqld]
# 基本設定
innodb_buffer_pool_size = 2G
innodb_redo_log_capacity = 256M
innodb_log_buffer_size = 32M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT
innodb_file_per_table = ON
innodb_io_capacity = 200
innodb_io_capacity_max = 400

# クエリパフォーマンス
max_connections = 150
thread_cache_size = 50
tmp_table_size = 64M
max_heap_table_size = 64M
sort_buffer_size = 2M
read_buffer_size = 1M
read_rnd_buffer_size = 2M
join_buffer_size = 2M
table_open_cache = 2000
table_definition_cache = 2000

# InnoDB設定
innodb_thread_concurrency = 4
innodb_read_io_threads = 4
innodb_write_io_threads = 4
innodb_lru_scan_depth = 1024
innodb_change_buffer_max_size = 25
innodb_adaptive_hash_index = ON
innodb_print_all_deadlocks = ON

# パフォーマンススキーマ
performance_schema = ON

# その他の最適化
skip-name-resolve = ON
max_allowed_packet = 16M

# バイナリログ設定
log_bin = mysql-bin
binlog_format = ROW
sync_binlog = 0

# セキュリティ設定（既存の設定を維持）
secure_file_priv = "/docker-entrypoint-initdb.d/csv"
lower_case_table_names = 1

# HDD用の設定
innodb_flush_neighbors = 1
innodb_read_ahead_threshold = 56
innodb_random_read_ahead = ON

# MySQL 8.0固有の設定
innodb_dedicated_server = ON
innodb_buffer_pool_instances = 4
binlog_expire_logs_seconds = 604800
innodb_fsync_threshold = 0